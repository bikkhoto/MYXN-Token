
**MASTER  PROMPT — “MYXN Mainnet Deployment Suite (SPL + Metadata + Presale + Vesting + Conditional LP)”**

You are an expert Solana/Anchor full-stack engineer. Generate a production-ready repository that implements the full $MYXN deployment and presale lifecycle required by the MyXen Foundation. Produce well-documented code, strong tests, and a safe, auditable CI/CD deploy flow. Follow the exact sequence and constraints below. The output should include files, scripts, configuration, and a README with exact run commands. Do not include any private keys or secrets in the repo — use environment variables and hardware wallet signing for final authority moves.

--- Requirements / High-level goals

1. Create an Anchor program (Rust) for:

   * Presale escrow and purchase records
   * Vesting accounts and linear claim engine (supports 5%/day × 20 days for presale buyers, configurable)
   * Conditional LP creation trigger (configurable thresholds)
   * Fee routing helper (burn, charity, liquidity buffer, treasury)
   * Admin controls (finalize presale, enable refunds) — no multisig; admin = TREASURY_PUB for now
2. Provide JS/TS deployment scripts that run on Node with @solana/web3.js, @project-serum/anchor, @solana/spl-token:

   * `scripts/myxen-mainnet-mint.sh` (or `.ts`) — create mint, create treasury ATA, mint full supply to treasury, output TOKEN_MINT and TREASURY_TOKEN_ACCOUNT
   * `scripts/attach-metadata-mainnet.js` — upload metadata JSON to web3.storage when needed and attach metadata on-chain (create metadata PDA). Ensure metadata is created/signed by TEMP_KEY and document how CREATOR signature is obtained to get `verified:true`.
   * `scripts/transfer-authorities.js` — transfer mint & freeze authorities to HARDWARE_AUTH_PUB using CLI commands or programmatic calls (instructions printed for hardware wallet signing)
   * `scripts/finalize-presale.js` — presale finalization, conditional LP creation logic (with safe checks), and optional LP lock via chosen locker
   * `scripts/refund-presale.js` — refund flow if presale < MIN_THRESHOLD
   * `scripts/revoke-authorities-guide.md` — step-by-step commands for irreversible revoke (to be run by hardware wallet)
3. Metadata & storage:

   * Include a `metadata/metadata.json.template` with placeholders:

     * `METADATA_URI` (ipfs CID)
     * `IMAGE_URI` (ipfs CID)
     * `mobile_application.repo_url` => `https://github.com/bikkhoto/MyXen-Mobile-Application.git`
     * creators array with `address` = TREASURY_PUB and `verified` field set to false by default; include instructions so the creator signs to set `verified:true` during metadata creation.
   * Provide `scripts/upload-metadata-web3storage.js` that:

     * Uses `WEB3_STORAGE_TOKEN` env var
     * Uploads files (metadata JSON + image) to web3.storage
     * Returns IPFS CIDs and writes a `.metadata.cids.json` file
4. Safety & pre-checks:

   * All scripts must check balances (temp signer SOL >= 0.05 SOL) and abort safely on insufficient funds.
   * Validate addresses (base58 checks) before running irreversible steps.
   * Confirm `TREASURY_PUB` and `HARDWARE_AUTH_PUB` via interactive confirmation prompt in scripts (or print and require `CONFIRM=true` env var).
   * All tx signatures must be written to `deploy-records/` with timestamped filenames.
   * No irreversible revoke step is included in automated scripts — only a signed manual guide that uses the hardware wallet.
5. Deliverables (files & structure)

   * `anchor/` — Anchor program, tests, IDL, migrations
   * `programs/` — rust code for presale, vesting, fee routing, LP trigger
   * `scripts/` — all deploy scripts named above (`myxen-mainnet-mint.sh`, `attach-metadata-mainnet.js`, `transfer-authorities.js`, `finalize-presale.js`, `refund-presale.js`)
   * `metadata/metadata.json.template` — metadata template with placeholders
   * `deploy-records/` — directory written to by scripts at runtime (not committed)
   * `README.md` — runbook with EXACT command sequence and output examples (include solana CLI and Anchor commands)
   * `ci/` — CI checks for linters and tests (optional)
6. Exact Runbook (README) — include these command sequences and confirmations:

   * Configure solana CLI:
     `solana config set --url https://api.mainnet-beta.solana.com`
   * Pre-check temp signer balance (script should check):
     `solana balance --keypair /path/to/tmp-keypair.json`
   * Run mint script (returns TOKEN_MINT & TREASURY_TOKEN_ACCOUNT):
     `bash scripts/myxen-mainnet-mint.sh --keypair /path/to/tmp-keypair.json --treasury-pub <TREASURY_PUB>`
   * Upload metadata to web3.storage (if needed):
     `node scripts/upload-metadata-web3storage.js --input metadata/metadata.json.template --image metadata/image.png`
     *Script writes METADATA_CID and IMAGE_CID to `.metadata.cids.json`*
   * Attach metadata on-chain (signed by temp key; include instruction how to get creator to sign to get verified true):
     `node scripts/attach-metadata-mainnet.js --keypair /path/to/tmp-keypair.json --metadata-cid <CID>`
     *Print Tx signature and metadata PDA; store in deploy-records/*
   * Verify mint & treasury:
     `spl-token mint-info <TOKEN_MINT>`
     `spl-token account-info <TREASURY_TOKEN_ACCOUNT>`
   * Transfer mint & freeze authorities to hardware wallet: (prep only; hardware wallet must sign this command)
     `spl-token authorize <TOKEN_MINT> mint --new-authority <HARDWARE_AUTH_PUB> --owner /path/to/tmp-keypair.json`
     `spl-token authorize <TOKEN_MINT> freeze --new-authority <HARDWARE_AUTH_PUB> --owner /path/to/tmp-keypair.json`
     *Script captures tx sigs; confirm via `spl-token mint-info` showing hardware pub*
   * After presale escrow & vesting are deployed and audited, hardware wallet owner will run revoke commands (guide included).
7. Presale & Vesting specifics (configurable constants / on-chain params)

   * `TOTAL_SUPPLY = 1_000_000_000 * 10^9`
   * `PRESALE_TOKENS = 500_000_000 * 10^9`
   * `PRESALE_PRICE_USD = 0.007` (config)
   * `PRESALE_MAX_PER_WALLET_USD = 2000`
   * `VESTING: cliff=0, daily_release_bps=500 (i.e., 5%/day), days=20`
   * `LP_TARGET_USD = 2_000_000`
   * `LP_MIN_THRESHOLD_USD = 1_200_000`
   * `LP_LOCK_MONTHS = 12`
8. Conditional LP creation:

   * Implement helper that uses `PRESALE_STATE.raised_usd` and if `>= LP_MIN_THRESHOLD_USD` then:

     * Use `liquidity_amount` from allocations to create LP (Raydium/Orca instructions or programmatic guidance to AMM)
     * Lock LP tokens using an on-chain locker or by sending LP tokens to a documented locker program (include references / TODO)
   * If `< threshold` then finalize presale as `failed` and enable refund route (atomic refund function).
9. Metadata verification (`verified:true`):

   * Metadata creation script must include instructions for the creator address (TREASURY_PUB) to sign the metadata creation/update transaction to set `creators[0].verified = true`. Provide sample CLI command and Anchor JS snippet showing how to sign with the creator key (they must do this with hardware wallet).
10. Tests and simulation:

    * Provide unit tests for:

      * Presale purchase flows (happy path + refund path)
      * Vesting claim math
      * Fee routing math (split into burn/charity/liquidity/treasury)
      * LP conditional trigger (simulate `raised_usd` scenarios)
    * Provide simulation scripts that run locally on devnet/test validator.
11. Logging & records:

    * All scripts write outputs and tx signatures to `deploy-records/` with ISO8601 timestamps.
    * Script `scripts/verify-onchain.sh` that prints required verification outputs:

      * `spl-token mint-info <TOKEN_MINT>`
      * `spl-token account-info <TREASURY_TOKEN_ACCOUNT>`
      * Metadata PDA and account data
      * Solscan links (print pattern using TOKEN_MINT)
12. Developer ergonomics:

    * Use env vars: `TMP_KEYPAIR_PATH`, `WEB3_STORAGE_TOKEN`, `TREASURY_PUB`, `HARDWARE_AUTH_PUB`, `NETWORK`
    * Provide `.env.example` with placeholders (do NOT commit secrets)
13. Documentation & README:

    * Include “Risk & Mitigations” section and the same exact safety checks you wrote earlier (insufficient fees, wrong addresses, private key exposure).
    * Provide the exact checklist you will ask the operator to paste back after each run (TOKEN_MINT, TREASURY_TOKEN_ACCOUNT, spl-token outputs, metadata tx sig, mint-info showing hardware pub, METADATA_PDA value + solscan links).
14. Final note for Copilot: be explicit in generated code comments that multisig is intentionally omitted and will be added later by converting the treasury to a multisig. All hardcoded addresses are placeholders and must be replaced with environment variables before running on mainnet.

--- END PROMPT

Paste the exact block above into GitHub Copilot and let it generate the repository files. After Copilot generates code, run the repo tests locally on devnet first. Use `scripts/myxen-mainnet-mint.sh` only when `--network mainnet-beta` and after you physically confirm the hardware wallet is ready to receive authorities.

If you want, I will now:

* produce the **exact `metadata/metadata.json.template`** populated with your image + mobile repo fields,
* or generate the **first draft of `myxen-mainnet-mint.sh`** and `attach-metadata-mainnet.js` as Copilot-ready snippets.


